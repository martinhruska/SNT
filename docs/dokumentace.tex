\documentclass[a4paper, 12pt]{article}
\usepackage[left=1.5cm, text={18cm, 25cm}, top=2.5cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[czech]{babel}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{float}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tikz}
\usepackage{url}
\usepackage{comment}
\usepackage[longend,ruled,vlined,commentsnumbered,linesnumbered,czech]{algorithm2e}
\newcommand{\myuv}[1]{\quotedblbase #1\textquotedblleft}
\newcommand{\rcps}[0]{Resource Constraint Project Scheduling}

\title{\rcps}
\author{Martin Hruška\\xhrusk16@stud.fit.vutbr.cz}

\date{}
\begin{document}

\maketitle

\section{Úvod}
\label{sec:intro}
\rcps\ (RCPS) problém lze formulovat jako otázku, zdali pro danou množinu aktivit,
z~nich každá má určitou dobu trvání, existuje rozvrh, v~němž mohou být provedeny.
Mezi aktivitami je také definována relace precedence a dále má každá požadavky na zdroje,
jejichž množství je omezené. 
Optimalizace RCPS problém pak spočívá v~nalezení rozvrhu s~nejkratší dobou trvání.

Jelikož je RCPS problém NP-úplný \cite{artigues:2007}, tak se k~jeho řešení používají metody jako
lineární programování, genetické nebo optimalizační (Ant Colony Optimization) algoritmy, či jiné heuristiky.
Tato práce se ale zabývá implementací optimalizátoru RCPS problému, nazvaného \emph{RCPSSolver},
založeného na redukci RCPS problému na SAT problém.
Při tomto způsobu řešení lze použít nástroje pro řešení SAT problému, které se nazývají SAT solvery.
Ty učinily v~posledních letech svého vývoje výrazný pokrok a dokáží řešit i obtížné instance problému \cite{horbach:10}.
Při redukci RCPS problému na SAT problém je také možné určit zdroj exponenciální složitosti a tu
omezit vhodnou implementací, při níž se předchází generování exponenciálního množství klausulí pro SAT problém.
Výhodou tohoto řešení je také, že se nejedná pouze o~numerickou aproximaci řešení, ale podává přesné výsledky.
Tato práce bude vycházet z~přístupu k~redukci RCPS problému na SAT problému popsaného v~\cite{horbach:10}.

RCPSSolver využívá existující SAT solvery a to Glucose a MiniSAT.
Vstupem pro RCPSSolver jsou instance RCPS problému z~PSPLIB, což je knihovna obsahující sadu benchmarků
pro RCPS problém.

Struktura tohoto dokumentu bude následující.
Sekce \ref{sec:analysis} obsahuje analýzu problému, formální definici RCPS a SAT problémů.
V~sekci \ref{sec:concept} je popsána samotná redukce na SAT problém a v~sekci \ref{sec:arch}
architektura implementovaného nástroje.
Sekce \ref{sec:exps} shrnuje provedené experimenty s~vytvořeným nástrojem.

\section{Analýza \rcps}
\label{sec:analysis}
V~této sekci bude napřed formálně definován \rcps\ problém a optimalizační problém s~ním související.
Dále bude popsána knihovna PSPLIB a následně bude definován SAT problém.

\subsection{Formální definice RCPS}
\rcps je definován šesticí $(V, p, E, R, B, b)$ \cite{artigues:2007}, kde
\begin{enumerate}
    \item $V=\{A_0, \ldots, A_{n+1}\}$ je množina aktivit, které mají být vykonány.
    Dle konvence je $A_0$ aktivita reprezentující začátek rozvrhu a $A_{n+1}$ aktivita reprezentující konec rozvrhu.
    \item $d: V~\rightarrow \mathbb{N}$ je funkce udávající dobu trvání aktivit.
    \item $E \subseteq V\times V$ je precedenční relace.
    Pokud $(A_i, A_j) \in E$, tak aktivita $A_i$ musí být provedena před aktivitou $A_j$.
    \item $R=\{R_1,\ldots,R_q\}$ je množina zdrojů.
    \item $B: R \rightarrow \mathbb{N}$ je funkce udávající kapacitu zdrojů.
    \item $b: V~\times R \rightarrow \mathbb{N}$ je funkce udávající množství určitého zdroje, které vyžaduje daná aktivita pro
    svoje provádění.
\end{enumerate}

Řešením tohoto problému je vektor $<S_0,\ldots,S_{n+1}>$, kde $S_i$ je doba začátku aktivity $A_i$.
Toto řešení můžeme nazývat rozvrhem.
Řešení musí splňovat omezení daná precedenční relací a dostupností zdrojů, což lze formálně zapsat následovně:
\begin{equation}
 \forall (A_i,A_j) \in E: S_j - S_i \geq d(A_i)
\end{equation}
\begin{equation}
 \forall R_k \in R\ \forall t \geq 0: \sum_{A_i \in A_t} b(A_i, R_k) \leq B(k)
\end{equation}
kde $A_t=\{A_i \in A\,|\, S_i \leq t \leq S_i+p(A_i)\}$.

Kritériem optimálnosti u~\rcps\ je tzv. \emph{makespan}, což je doba začátku provádění aktivity $A_{n+1}$.
Optimalizačním problémem tedy je nalezení řešení \rcps\ úlohy s~minimální makespan.

V~dalším textu jsou uvažovány \emph{single-mode} \rcps\ úlohy.
Single-mode znamená, že aktivity dané úlohy mají pouze jeden mód činnosti
na rozdíl od tzv. \emph{multi-mode} úloh jejichž aktivity mají více módu činnosti
a každý mód má odlišné požadavky na spotřebu zdrojů.

Pro instanci RCPS problému také uvažujeme u~jejich aktivit časy nejdřívějšího a nejpozdějšího možného začátku (a
také konce) činnosti dané aktivity.
Dále se pro instanci zjišťuje doba hodnota \emph{kritické} cesty váženým grafem vytvořeným tak, že uzly odpovídají jednotlivým
aktivitám a hrany jsou ohodnoceny dobou jejich trvání a jsou mezi uzly, jejichž aktivity jsou navzájem v~precedenční
relaci.
Kritická cesta je nejdelší cesta mezi uzly představujícími aktivitu $0$ a aktivitu $n+1$ a je vypočítána
pomocí Floyd-Warshallova algoritmu.
Z~tohoto výpočtu dostáváme také údaje o~nejdelších cestách mezi jednotlivými uzly, což lze následně použít
při výpočtu doby nejdřívějšího a nejpozdějšího začátku.
Kritická cesta pak představuje dobu, za kterou by šla úloha splnit nejdříve, pokud by neexistovalo omezení daná
množstvím zdrojů, ale pouze omezení dané precedenční relací.
Kritická cesta bude v~následujícím textu uvažována jako spodní hranice řešení, tedy hranice u~níž víme, že nelze
dosáhnout nižšího makespan, než je její hodnota.
Opakem je poté horní hranice řešení, která udává maximální dobu, kterou může makespan nabývat a jejíž volba
byla během implementace různá, více v~sekci \ref{sec:arch}.

\subsection{PSPLIB}
PSPLIB je knihovna sdružující sady instancí \rcps\ problému v~jeho různých variantách a jejich optimální a heuristická řešení \cite{psplib}.
Knihovna používá ke generování instancí problému vlastní nástroj \emph{ProGen}.
Ve shodě se zadáním projektu byly použita data knihovny PSPLIB jako vstupy dokumentovaného nástroje.
Použití knihovny je vhodné také díky možnosti porovnávat výstupy vytvořeného programu s~optimálními řešeními, které
knihovna pro mnoho instancí problému obsahuje.
Příklad vstupních dat lze najít v~adresáři \emph{input}.

\subsection{SAT Solving}
Metody a nástroje SAT solvingu se zabývají řešením SAT problému (je NP-úplný),
který spočívá v~zodpovězení otázky, zdali je daná formule výrokové logiky splnitelná.
V~našem případě uvažujeme formuli výrokové logiky v~\emph{konjunktivní} normální formě (CNF).
Taková formule je definovaná přes množinu proměnných, které nabývají hodnoty z~množiny $\{true, false\}$
a je složena z~následujících prvků:
 \begin{itemize}
 	\item \emph{Literálů}, což jsou samotné proměnné nebo jejich negace
 	\item \emph{Klausulí}, což jsou disjunkce ($\vee$) literálů
	\item Samotná výroková formule v~CNF je pak konjunkcí ($\wedge$) klausulí.
 \end{itemize}.

Ohodnocení formule je konkrétní zobrazení jejich proměnných na hodnoty $\{true, false\}$.
Formule je \emph{splnitelná}, pokud existuje ohodnocení, při kterém je celá formule vyhodnocena
jako $true$.
Takové ohodnocení se potom nazývá modelem formule v~CNF.

Programy řešící SAT problém se nazývají \emph{SAT solvery}.
V~poslední době proběhl v~oblasti SAT solverů výrazný pokrok a mnohé z~nich jsou již
schopny  řešit SAT problémy obsahující velké formule.
Porovnání možností a výkonu SAT solverů lze najít na \cite{www:sat}.

Základním algoritmem používaným v~SAT Solvingu (a dnešních SAT solverech) je
\emph{Davis–Putnam\-Logemann–Loveland (DPLL) algoritmus} \cite{dpll:1960, dpll:1962}.
Algoritmus je uveden v~Algoritmu \ref{alg:dpll} a bude následovat jeho krátký popis.

Funkce \emph{propagate} ohodnotí proměnné na základě aktuálního částečného ohodnocení tak, že
provedená nová ohodnocení jsou důsledkem aktuálního stavu.
Pokud při tomto ohodnocení nevznikne konflikt, t.j. jedna klausule při určitém ohodnocení některé z~proměnných nabude hodnoty $true$,
zatímco jiná (konfliktní) klausule se při takovémto ohodnocení stane $false$, tak pokud jsou již ohodnoceny všechny proměnné, je vrácena
hodnota $true$.
Pokud konflikt nenastane, ale nejsou ohodnoceny všechny proměnné tak, je zvýšena úroveň zanoření při rozhodování (proměnná decision\_level)
a je zavolána funkce \emph{decide}, která rozhodne, která další proměnná bude ohodnocena a na které se tedy bude další výpočet větvit.

Pokud funkce propagate vrátí konfliktní klausuli, tak je zavolána funkce \emph{analyze}, která určí ke které úrovni zanoření při ohodnocování
proměnných se bude navracet, aby bylo možné konfliktu předejít.
Všechna ohodnocení provedena hlouběji než v~této úrovni jsou pak zrušena.
V~moderních SAT solverech funkce analyze také dokáže vytvořit \emph{naučenou} klausuli, která je důsledkem aktuální databáze klausulí a která
má popisovat příčinu posledního konfliktu konfliktu.

\begin{algorithm}
\label{alg:dpll}
    \KwIn{CNF formule}
    \KwOut{$true$ pokud je formule splnitelná, jinak $false$}
    decision\_level = 0\;
    \While{$true$}
    {
        propagate()\;
        \eIf{Není konflikt}
        {
            \eIf{Všechny proměnné přiřazeny}
            {
                \Return $true$\;
            }
            {
                ++decesion\_level\;
                decide()\;
            }
        }
        {
            analyze()\;
            \eIf{Nalezen konflikt na nejvyšší úrovni}
            {
                \Return $false$\;
            }
            {
                backtrack()\;
            }
        }
    }
\caption{DPLL Algoritmus}
\end{algorithm}

V~této práci byly použity SAT solvery \emph{MiniSAT} \cite{www:minisat} a \emph{Glucose} \cite{www:glucose}, která
používají další optimalizace k~zlepšení efektivity výpočtu.
MiniSAT byl vybrán na základě článku \cite{horbach:10}, kde byl úspěšně použit právě pro řešení RCPS problému.
Glucose je solver založený na MiniSATu, ale implementující některé další optimalizace.
Jelikož Glucose zachovává rozhraní MiniSATu je možné ho rozšířit stejným způsobem.

\section{Konceptuální model}
\label{sec:concept}
Jak již bylo zmíněno, v~této práci je RCPS problém řešen jeho redukcí na SAT problém a následným použitím pomocí SAT solveru.
V~této kapitole bude právě tato redukce popsána a to dle přístupu z~\cite{horbach:10}.

SAT formule budou definovány nad následujícími proměnnými:
\begin{itemize}
    \item Startovací proměnné $s_{it}$, kde $i\in V$ a $t\in{es_i,\ldots,ls_i}$, pro které platí: \newline 
    $s_{it}=
        \left\{
        \begin{array}{ll}
             true & \mbox{pokud} \emph{ aktivita }i \emph{ začíná v~čase }t \\
             false & \mbox{jinak}\\
        \end{array}
        \right.
        $
    \item Procesní proměnné $u_{it}$, kde $i \in V$ a $t \in {es_i,\ldots, lf_i}$, pro které platí: \newline
    $u_{it}=
        \left\{
        \begin{array}{ll}
             true & \mbox{pokud} \emph{ aktivita }i \emph{ je prováděna  v~čase }t \\
             false & \mbox{jinak}\\
        \end{array}
        \right.
        $
\end{itemize}

Nyní přistupme k~samotné redukci RCPS problému do CNF formulí.
Správná kombinace startovacích a procesních proměnných je zaručena pomocí tzv. \emph{klausulí konzistence}:
\begin{equation}
\label{eq:1}
   \neg s_{it} \vee u_{il},\emph{ kde } i\in\{es_i,\ldots,ls_i\}, l\in\{t,\ldots,t+d_i-1\}  
\end{equation}
kde $t$ je doba začátku aktivity.

Dodržení omezení daných precedenční relací zajišťují tzv. \emph{precedenční klausule}:
\begin{equation}
\label{eq:2}
   \neg s_{it} \bigvee_{l\in\{es_j,\ldots,t-d_j\}} s_{jl},\emph{ kde } (j,i) \in E, t \in\{es_i,\ldots,ls_i\}   
\end{equation}
Oproti přístupu z~\cite{horbach:10} je zde použito $l\in\{es_j,\ldots,t-d_j\}$ namísto $l\in\{es_j,\ldots,es_i-d_j\}$ tak,
aby klausule skutečně vyjadřovala, že začne-li aktivita $i$ v~čase $t$, tak aktivita, která ji má dle precedenční
relace předcházet, začala dříve alespoň o~dobu svého trvání.

Dalším typem klausulí jsou \emph{klausule startovací}, které zaručují, že každá aktivita někdy začne:
\begin{equation}
\label{eq:3}
   \bigvee_{t\in\{es_i,\ldots,ls_{i}\}} s_{it},\emph{ kde } i \in
V~\end{equation}

Dosud uvedené klausule nezaručují, že nebude v~jeden okamžik naplánováno více aktivit, které ovšem můžou mít dohromady
větší nároky na některý zdroj než je jeho dostupné množství.
Takovouto množinu aktivit $C$, pro kterou u~některého zdroje $k$ platí $\sum_{i\in C} r_{ik} > R_k$, nazveme \emph{pokrytím}.
Minimální pokrytí je takové, že bez některé aktivity $i\in C$, přestává být množina $C$ prokrytím.
Nepřečerpání některého ze zdrojů lze zajistit prostřednictvím \emph{klausulí pokrytí}:
\begin{equation}
\label{eq:4}
   \bigvee_{i\in C} \neg u_{it},\emph{ kde } t\in{0,\ldots,T-1}, C \emph{ je minimální pokrytí}   
\end{equation}

Každá množina klausulí z~definic~\ref{eq:1},\ref{eq:2},\ref{eq:3} nabývá polynomiální velikosti a je tedy řešitelná pomocí moderních SAT solverů,
a proto je možné je vygenerovat na základě instance RCPS problému před spuštěním SAT solveru.
Počet klausulí z~definice \ref{eq:4} ovšem roste exponenciálně, a tudíž by jejich kompletní vygenerování bylo možné jen pro instance
s~malým počtem aktivit,
Proto jsou tyto klausule v~RCPSSolveru přidávány do databáze SAT solveru dynamicky.
Bližší informace stran implementace samotné jsou v~sekci \ref{sec:arch}.

Aby bylo možné provádět samotnou optimalizaci, je třeba přidat klausule omezující maximální makespan.
Nazvěme tyto klausule \emph{časovými}:
\begin{equation}
\label{eq:5}
   \neg s_{n+1,t}\emph{ kde } t\in{(l+1),\ldots, ub}, \emph{ l je maximální makespan, ub je horní hranice.}
\end{equation}

Stejně jako v~\cite{horbach:10} byly přidány následující klausule, které přináší zrychlení výpočtu SAT solveru:
\begin{equation}
\label{eq:6}
   \neg u_{it} \vee u_{i,t+1} \vee u_{i,t-d_i+1},\emph{ kde } i\in V, t\in\{ef_i,\ldots,lf_i-1\}  
\end{equation}
Klausule udávají, že doba $t$ je doba konce aktivity $i$ a SAT solver může odvodit, že aktivita $i$ začíná v~době
$t-d_i+1$.

Tím je redukce RCPS problému na SAT problém kompletní včetně zakódování optimalizačního problému a přidání
klausulí zrychlujících výpočet SAT solveru.

\section{Architektura}
\label{sec:arch}
V~této sekci bude popsána architektura implementovaného programu, implementační optimalizace a budou zmíněny použité SAT solvery.

Logický návrh architektury programu je na Obrázku \ref{fig:arch}.
Program nejprve načte vstup, kterým je soubor z~knihovny PSPLIB, poté ho
převede do interní reprezentace (na Obrázku \ref{fig:arch} jako \emph{Instance RCPS problému}).
V~této interní reprezentaci se instance RCPS problému předá optimalizátoru,
který pomocí příslušných modulů vypočte kritickou cestu a s~ní související informace a doplní je do reprezentace RCPS problému.
Následně je vytvořena interní reprezentace SAT problému (SAT formule v~CNF), která je následně
převedena do reprezentace příslušného SAT solveru, který je na závěr spuštěn.
Optimalizátor toto postupně provádí pro jednotlivé makespan, dokud není nalezen ten nejnižší možný.
\begin{figure}
\begin{center}
    \input{arch.tikz}
    \caption{Konceptuální návrh programu}
    \label{fig:arch}
\end{center}
\end{figure}

Následuje seznam tříd implementující jednotlivé bloky z~logického návrhu programu:
\begin{itemize}
 \item Parser
    \begin{itemize}
        \item Třída \emph{RCPSParser} obsahuje metody pro načtení souboru se vstupem z~PSPLIB a převede ho do interní
        reprezentace RCPS problému (třída \emph{RCPSInstance}).
    \end{itemize}
 \item Instance RCPS problému
    \begin{itemize}
        \item Třída \emph{RCPSInstance} v~sobě uchovává informace uvedené v~definici RCPS problému v~sekci \ref{sec:analysis}.
        Uchovává také informace o~nejdřívějších a nejpozdějších možných časech začátků a konců jednotlivých aktivit.
    \end{itemize}
 \item Výpočet kritické cesty
    \begin{itemize}
        \item Třída \emph{RCPSGraph} reprezentuje graf, do které ho je převeden RCPS problém, aby mohla být spočítaná kritická cesta a s~ní
        související informace jako možné časy začátků a konců aktivit.
        Obsahuje také metody pro výpočet této kritické cesty pomocí Floyd-Warshallova algoritmu.
    \end{itemize}
 \item Interní SAT model
    \begin{itemize}
        \item Třída \emph{RCPSSATModel} reprezentuje interně SAT problém, na který byl redukován RCPS problém.
        Obsahuje také metody pro tuto redukci.
    \end{itemize}
 \item Převod do reprezentace SAT solveru
    \begin{itemize}
        \item Třída \emph{RCPSModel2Glucose} obsahuje metody převádějící interní SAT model v~třídě \emph{RCPSSATModel}
        do interní reprezentace SAT solveru \emph{Glucose}.
        \item Třída \emph{RCPSModel2Minisat} obsahuje metody převádějící interní SAT model v~třídě \emph{RCPSSATModel}
        do interní reprezentace SAT solveru \emph{MiniSAT}.
    \end{itemize}
 \item Byly použity následující dva SAT solvery:
    \begin{itemize}
        \item \emph{MiniSAT} \cite{www:minisat} je SAT solver použity v~\cite{horbach:10}.
        Dříve patřil mezi nejlepší SAT solvery (oceněný v~soutěži \cite{www:sat}), dnes již neimplementuje
        všechny aktuální heuristiky a optimalizace používané v~SAT Solvingu.
        \item \emph{Glucose} \cite{www:glucose} je nadstavbou nad MiniSAT, která implementuje
        pokročilejší optimalizace a je v~posledních letech oceňována v~soutěži SAT Competition \cite{www:sat}.
        Zachovává rozhraní MiniSAT, tudíž ji bylo možné použít bez nutnosti výraznějších změn postupů použitých při
        modifikaci MiniSAT.
    \end{itemize}
 \item Optimalizátor
    \begin{itemize}
        \item Třída \emph{RCPSOptimizer} realizuje vlastní výpočet a optimalizaci pomocí ostatních modulů.
    \end{itemize}
\end{itemize}

\subsection{Modifikace SAT solveru}
Jak bylo řečeno v~sekci \ref{sec:concept}, roste množství klausulí pokrytí \ref{eq:4} exponenciálně,
proto není možné tyto klausule vygenerovat před spuštěním samotného SAT solveru.
Je nutné je generovat dle potřeby během výpočtu, což lze udělat tak \cite{horbach:10}, že je spuštěn SAT solver bez
těchto klausulí a na základě vypočteného ohodnocení proměnných je ověřováno, že v~žádném čase
nedošlo k~přečerpání žádného zdroje.
Pokud by k~tomuto došlo, je přidána příslušná klausule pokrytí, která tomu zabrání a SAT solver je spuštěn
znovu.
Nevýhoda tohoto přístupu je taková, že SAT solver vždy ztrácí celý kontext výpočtu a musí začínat od začátku, a proto
je tento přístup vhodný jen u~malých problému, a tedy nebyl v~této práci implementován.

Implementován byl přístup, který modifikuje funkci \emph{propagate} v~SAT solveru.
Vždy když je pravdivě ohodnocen nějaký literál obsahující procesní proměnnou $u_{it}$, tak je zkontrolováno,
zdali tímto ohodnocením není v~čase $t$ překročeno množství některého ze zdrojů použitých aktivitou $i$.
Pokud ano, je vygenerována příslušná klausule pokrytí, která je přidána do databáze klausulí a vrácena jako konfliktní klausule.
Pokud k~takovému porušení nedochází, jsou vygenerovány klausule pokrytí zabraňující tomu, aby byla 
(dosud neohodnocená) procesní proměnná $u_{jt}$ ohodnocena jako $true$,
pokud by činnost aktivity $j$ v~čase $t$ vedla k~přečerpání některého ze zdrojů.

Přidání nové klausule za běhu nebylo možné provést přes funkci \emph{addClause} z~rozhraní SAT solverů, ale použitím
interní funkce \emph{attachClause} a přidáním nové klausule na zásobník klausulí v~proměnné \emph{clauses}.

Další provedenou optimalizací je upřednostnění výběru procesních proměnných ve funkci \emph{decide} před výběrem
startovacích proměnných.
Tato optimalizace je také navržena v~\cite{horbach:10} a empirickými experimenty s~programem RCPSSolver
byl ověřeno, že skutečně zrychluje výpočet.

\subsection{Hledání optimálního řešení}
Původně bylo hledání optimálního řešení implementováno tak, že se před
zahájením samotné optimalizace vypočetla kritická cesta a s~ní související informace.
Poté byl zvolen makespan dle horního odhadu uvedeného v~popisu instance z~PSPLIB
a ten byl postupně snižován dokud nebylo dosaženo spodní hranice, která
byla dána kritickou cestou.
Poslední makespan, u~kterého bylo možné najít řešení RCPS problému byl pak prohlášen
za optimální řešení.
Tento přístup se ovšem ukázal jako velmi neefektivní, a proto byl
implementován jiný, v~němž se prohledává od spodní hranice dané kritickou cestou,
makespan se zvyšuje o~jedna a jako horní hranice je brána hodnota o~jedna
vyšší než aktuální makespan.
Pro tuto horní hranici jsou spočteny nejdřívější a nejpozdější možné začátky
jednotlivých aktivit a teprve poté je RCPS problém zakódován do SAT problému.
Tento postup se ukázal jako efektivnější nejen v~hledání optimálního řešení, ale i
v~rozhodování jedné instance SAT problému, protože obsahují méně proměnných. 

\subsection{Implementační problémy}
\label{sub:impl}
SAT solvery při řešení větších instancí končily chybou \texttt{segmentation fault}.
Příčinu této chyby se nepodařilo zjistit a není zřejmé, zdali se jedná
o~chybu zanesenou implementací dynamického přidávání klausulí a nebo o~chybu
způsobenou velikostí řešeného problému.
Proto v~případech, kdy by mělo k~chybě \texttt{segmentation fault} dojít,
je daná instance prohlášena za nesplnitelnou a je zvětšen makespan.
Touto cestou nemusí být nalezeno optimální řešení, protože právě kolem
hodnoty optimálního makespan dochází k~nárůstu složitosti výpočtu a tedy
i zmíněné chybě, ale lze dostat alespoň suboptimální řešení udávající
nejnižší makespan, pro který jde úloha vyřešit.
V~případě, že je použita tato heuristika, je vypsáno na standardní výstup
\emph{NON OPTIMAL}, aby bylo zřejmé, že výsledek nemusí být přesný.

\section{Experimenty}
\label{sec:exps}
S~implementovaným nástrojem byly provedeny experimenty nad vstupy
z~knihovny PSPLIB, konkrétně byly použity sady \emph{j30, j60, j120}, kde
číslice za písmenem 'j' udává počet aktivity, které obsahují instance v~dané sadě.
Měření byla provedena na počítači s~procesorem Intel Core 2 Duo (2.13 GHz) a 4 GiB paměti.
Časový limit pro optimalizaci jedné úlohy byl stanoven na $30$ minut.
Experimenty byly provedeny za použití SAT solveru MiniSAT a byl měřen čas
procesu na CPU.

V~tabulce \ref{table:jreses} jsou uvedeny výsledky experimentů.
V~tabulce je uvedeno procento úspěšně optimalizovaných úloh z~dané sady v~porovnání s~optimálními
časy uvedenými v~PSPLIB.
Dále také obsahuje kolik procent úloh z~dané sady bylo vyřešeno pod daný časový limit.
V~porovnání s~výsledky, k~nimž dospěl autor v~\cite{horbach:10}, není implementovaný
RCPSSolver tak efektivní a úspěšný.
To lze přisuzovat možným nedostatkům v~modifikaci SAT solveru, jejíž přesná podoba nebyla
v~\cite{horbach:10} přesně popsána.

\begin{table}[tb]
\begin{center}
\scalebox{0.7}{
  \begin{tabular}{ | l | r | r | r | r | r | r | r | r | r |}
   \hline
    & \textbf{Optimalizována [\%]} & Do 1s [\%] & Do 2s [\%] & Do 5s [\%] & Do 10s [\%] & Do 50s [\%] & Do 100s [\%] & Nad 100s [\%]\\ \hline \hline
    j30 &$83$ & $77$ & $2.3$  &$5$ & $2.9$ & $4.1$ & $ 0.8 $ & $7.9$ \\ \hline
    j60 & $70$ & $63.7$ & $12$ & $6.8$ & $2.8$ & $3.7$ & $1.6$ & $9.4$  \\ \hline
    j120 & $42 029$ & $42 029$ & & & \\ \hline
   \end{tabular}
}
   \caption{Tabulka výsledků s~experimenty se sadami j30, j60, j120 z~PSPLIB.}
   \label{table:jreses}
\end{center}
\end{table}

\begin{figure}[tb]
    \includegraphics[scale=0.5]{dst_j30}
    \includegraphics[scale=0.5]{dst_j60}
    \caption{Doba výpočtu SAT solveru v~závislosti na vzdálenosti makespan od optima v~instanci RCPS problému redukovaného na SAT.
    Výsledky pro sadu j30 (vlevo) a j60 (vpravo).}
    \label{pic:j30}
\end{figure}
\begin{figure}[tb]
    \begin{center}
    \includegraphics[scale=0.75]{dst_j30}
    \end{center}
    \caption{Doba výpočtu SAT solveru v~závislosti na vzdálenosti makespan od optima v~instanci RCPS problému redukovaného na SAT.
    Výsledky pro sadu j120.}
    \label{pic:j120}
\end{figure}

Dalším výstupem experimentů jsou grafy \ref{pic:j30}, \ref{pic:j120},
které ukazují dobu, kterou SAT solver potřeboval na rozhodnutí instance SAT problému
s~daným makespanem, v~závislosti na vzdálenosti tohoto makespan od optimálního.
V~grafu jsou zaneseny jen výsledky, u~nichž byla doba řešení úlohy delší nebo rovna 1 sekunda.
Takovýchto případů bylo $80\%$ u~sady j30, $72\%$ u~sady j60 a  TODO.
Z~grafu je patrné, že náročnost na řešení instancí SAT problému vzrostla blíže optimálnímu řešení instance RCPS problému.
Několik případů v~každé sadě bylo velmi náročných, což odpovídá výraznému navýšení doby výpočtu v~blízkosti optima.

Provedené experimenty ukazují, že pomocí SAT solvingu se daří optimalizovat většinu instancí z~PSPLIB.
Nicméně v~každé sadě se nachází několik těžkých případů, které se nepodařilo RCPSSolveru vyřešit.
U~těchto těžkých případů také docházelo také k~nárůstu doby výpočtu SAT solveru, který jinak dokázal
řešit zadané problémy velmi rychle.

\section{Závěr}
Byl implementován nástroj RCPSSolver pro optimalizaci instancí RCPS problému.
Nástroj je založen na redukci RCPS problému na SAT problém přístupem popsaným v~\cite{horbach:10}.
RCPSSolver využívá jako SAT solvery nástroje MiniSAT a Glucose, které byly modifikovány tak,
aby se omezila exponenciální složitost při řešení SAT problému.
S~nástrojem RCPSSolver byly provedeny experimenty nad instancemi RCPS problému
z~knihovny PSPLIB, které nástroj přijímá jako svoje vstupy.
V~experimentech se nedařilo dosáhnout stejně kvalitních výsledků, jichž bylo dosaženo v~\cite{horbach:10},
což lze přisoudit možným rozdílům v~modifikaci v~SAT solveru.
Výsledky experimentů ovšem ukazují, že přístup redukce z~RCPS problému na SAT problém
může být efektivním přístupem k~optimalizaci RCPS problému.

Další vývoj práce může být zaměřen na použití dalšího SAT solveru, či hlubší
modifikace některého z~použitých SAT solverů.
Také je možné zvolit jinou formulaci redukce na SAT problém, která by mohla být
efektivnější, či zvážit přidání dalších redundantních klausulí, které by ovšem
zrychlily výpočet SAT solveru.

\newpage
\appendix
\section{Instalace}
\label{app:install}
K~projektu je přiložen soubor \emph{Makefile}, tudíž lze zdrojové kódy zkompilovat pomocí příkazu \texttt{make}.
Pro úspěšnou kompilaci je nutné mít nainstalovaný překladač GCC verze 4.8 a také příslušné knihovny vyžadované
použitými SAT solvery.
Před spuštění je třeba dokončit konfiguraci prostředí skriptem \texttt{configure.sh} (určeno pro linuxové systémy),
který přidá do systémových proměnných cestu ke knihovnám MiniSAT.
Výstupem kompilace je spustitelný binární soubor \texttt{rcps\_solver} v~adresáři \texttt{bin}.
\section{Uživatelský manuál}
\label{app:help}
RCPSSolver lze spouštět z~příkazového řádku následujícím způsobem:
\\
\\
  rcps\_solver soubor [solver] [timeout]
  \begin{itemize}
    \item \texttt{soubor} $\ldots$ Cesta k~vstupnímu souboru s~instancí problému z~PSPLIB
    \item \texttt{solver} $\ldots$ Volba SAT solveru.  
    \begin{itemize}
        \item m $\ldots$ MiniSAT (default).
        \item g $\ldots$ Glucose.
    \end{itemize}
    \item \texttt{timeout} $\ldots$ Doba pro řešení optimalizačního problému.
    Neovlivní činnost SAT solveru, takže bude vždy před ukončením programu dořešena poslední SAT úloha.
    \item Pokud jsou oba použity nepovinné parametry \texttt{solver} i \texttt{timeout}, je nutné dodržet jejich pořadí.
  \end{itemize}

\section{Výstup}
\label{app:output}
RCPSSolver průběžně informuje o~svojí činnosti na standardní chybový výstup.
Na standardní výstup pak vypisuje následující informace:
\begin{itemize}
    \item \texttt{Makespan: $X$ [$Y$] $U$ $V$} $\ldots$ $X$ je aktuální makespan, $Y$ udává, zdali je úloha řešitelná v~daném makespan,
    $U$ je doba řešení SAT problému a $V$ celková doba řešení RCPS problému pro daný makespan, oba údaje jsou v~sekundách.
    \item \texttt{Done X} $\ldots$ X je celková doba výpočtu optimalizace RCPS problému v~sekundách.
    \item \texttt{Optimal: X} $\ldots$ X je optimální řešení RCPS problému nalezené RCPSolverem.
    \item \texttt{NON OPTIMAL} $\ldots$ byla použita heuristika ze sekce \ref{sub:impl} a výsledek nemusí být optimální.
\end{itemize}
Další výstupy pak mohou být informace, které vypisuje SAT solver.

\newpage
\bibliography{literatura}
\bibliographystyle{czechiso}
\end{document}
